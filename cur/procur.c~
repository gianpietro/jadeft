#include <form.h>
#include <stdlib.h>
#include <string.h>
#include "../inc/procur.h"
#include "../inc/prolib.h"


void providerWindow()
{
  FIELD *providerField[4];
  FORM *providerForm;
  int ch;
  char cf;   //confirm save data
  int actInd;
  char pname[30];

  initscr();
  cbreak();
  noecho();
  keypad(stdscr,TRUE);

  providerField[0] = new_field(1, 1, 6, 22, 0, 0);      /* height 1, width 2, y 6, x 22 */
  providerField[1] = new_field(1, 30, 8, 22, 0, 0);
  providerField[2] = new_field(1, 2, 10, 22, 0, 0);
  providerField[3] = NULL;

  field_opts_off(providerField[1], O_AUTOSKIP);       	/* Don't go to next field */

  providerForm = new_form(providerField);
  post_form(providerForm);

  mvprintw(2,5,"Jade Finacial Tracker\n");

  mvprintw(6, 5, "Active Ind:");
  mvprintw(8, 5, "Provider Name:");
  mvprintw(10, 5, "BLANK_TEST:");
  move(6,22);     /* move cursor */
  refresh();

  while((ch = getch()) != KEY_F(1))
    { 
      switch(ch)
        {
	case KEY_DOWN:
	  form_driver(providerForm, REQ_NEXT_FIELD);
	  form_driver(providerForm, REQ_END_LINE);
	  break;
	case KEY_UP:
	  form_driver(providerForm, REQ_PREV_FIELD);
	  form_driver(providerForm, REQ_END_LINE);
	  break;	  
        case 10:                                           // ASCII value for new line feed(Enter Key) 
	  form_driver(providerForm, REQ_NEXT_FIELD);
	  //form_driver(providerForm, REQ_END_LINE);
	  break;
        default:
	 form_driver(providerForm, ch);
	  break;
	}
    }

  mvprintw(12,5, "Form completed\n");
  //move(12,22);
  actInd = atoi(field_buffer(providerField[0],0));
  strcpy(pname, field_buffer(providerField[1],0));
   
  //mvprintw(14,5, "Active ind value %s",field_buffer(providerField[0],0));
  //mvprintw(14,5, "Provider name %s",field_buffer(providerField[1],0));
  mvprintw(14,5, "Value Active Ind: %d",actInd);
  mvprintw(15,5,"Value Provider Name: %s", pname);
  
  mvprintw(18,5,"Form save Y/N: ");
  echo();
  scanw("%c", &cf);
  mvprintw(19,5,"You entered: %c",cf);  
  refresh();
  noecho();
  providerInsert(actInd,pname);
  getch();
  
  unpost_form(providerForm);
  free_form(providerForm);
  free_field(providerField[0]);
  free_field(providerField[1]);

  endwin();  
}
